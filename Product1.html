<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOODIE FOR RIDER | FREE4ALLRIDERS</title>
    <link rel="icon" type="image/png" href="Head-imatge.PNG">
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --neon-pink: #ff00ff;
            --neon-purple: #9d00ff;
            --dark-purple: #4b0082;
            --black: #000000;
            --white: #ffffff;
            --glow-effect: 0 0 10px rgba(157, 0, 255, 0.7), 
                          0 0 20px rgba(255, 0, 255, 0.5);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: var(--black);
            color: var(--white);
            overflow-x: hidden;
        }
        
        /* Header Styles */
        header {
            background-color: rgba(0, 0, 0, 0.9);
            padding: 15px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--neon-purple);
            backdrop-filter: blur(5px);
        }
        
        .logo {
            height: 40px;
            filter: drop-shadow(var(--glow-effect));
        }
        
        nav {
            display: flex;
            align-items: center;
        }
        
        nav a {
            color: var(--white);
            text-decoration: none;
            margin-left: 20px;
            font-weight: 500;
            transition: all 0.3s;
            text-shadow: 0 0 5px var(--neon-pink);
        }
        
        nav a:hover {
            color: var(--neon-pink);
            text-shadow: 0 0 10px var(--neon-pink);
        }
        
        /* Main Container */
        .main-container {
            max-width: 1200px;
            margin: 100px auto 50px;
            padding: 0 20px;
            animation: fadeIn 0.8s ease-out;
        }
        
        /* Product Tabs */
        .tab-container {
            position: relative;
            width: 100%;
            overflow: hidden;
            border-radius: 10px;
            border: 1px solid var(--neon-purple);
            box-shadow: var(--glow-effect);
        }
        
        .tabs {
            display: flex;
            width: 200%;
            transition: transform 0.5s ease;
        }
        
        .tab {
            width: 50%;
            padding: 20px;
            display: flex;
            gap: 40px;
            background-color: rgba(0, 0, 0, 0.8);
        }
        
        /* Image Section */
        .image-section {
            flex: 1;
            position: relative;
        }
        
        .product-image {
            width: 100%;
            border-radius: 10px;
            border: 1px solid var(--neon-pink);
            box-shadow: var(--glow-effect);
        }
        
        .image-buttons {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }
        
        .img-btn {
            padding: 8px 15px;
            background-color: var(--neon-purple);
            color: var(--white);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 0 10px var(--neon-pink);
            transition: all 0.3s;
        }
        
        .img-btn:hover {
            background-color: var(--neon-pink);
            transform: translateY(-2px);
            box-shadow: 0 0 15px var(--neon-pink);
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            overflow: auto;
        }
        
        .modal-content {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 30px;
            color: var(--neon-pink);
            font-size: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .close-modal:hover {
            transform: rotate(90deg);
        }
        
        /* Login Modal */
        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
        }
        
        .login-content {
            background-color: rgba(0, 0, 0, 0.9);
            margin: 100px auto;
            padding: 30px;
            border: 1px solid var(--neon-purple);
            width: 90%;
            max-width: 400px;
            border-radius: 10px;
            box-shadow: var(--glow-effect);
            position: relative;
        }
        
        .close-login {
            position: absolute;
            top: 15px;
            right: 20px;
            color: var(--neon-pink);
            font-size: 25px;
            cursor: pointer;
        }
        
        .login-title {
            color: var(--neon-pink);
            text-align: center;
            margin-bottom: 25px;
            text-shadow: 0 0 10px var(--neon-pink);
        }
        
        .login-form input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--neon-purple);
            border-radius: 5px;
            color: var(--white);
            font-size: 16px;
        }
        
        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--neon-purple);
            color: var(--white);
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .login-btn:hover {
            background-color: var(--neon-pink);
            box-shadow: var(--glow-effect);
        }
        
        .error-message {
            color: #ff5555;
            text-align: center;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        /* Product Details */
        .details-section {
            flex: 1;
            padding: 20px;
        }
        
        .product-title {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--neon-pink);
            text-shadow: 0 0 10px var(--neon-pink);
        }
        
        .product-price {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 20px 0;
            color: var(--neon-purple);
        }
        
        .product-description {
            line-height: 1.6;
            margin-bottom: 25px;
            color: #ccc;
        }
        
        .size-selector {
            margin: 25px 0;
        }
        
        .size-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .size-option {
            padding: 8px 15px;
            border: 1px solid var(--neon-purple);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--white);
            background-color: transparent;
        }
        
        .size-option:hover {
            background-color: var(--neon-purple);
            box-shadow: var(--glow-effect);
        }
        
        .size-option.selected {
            background-color: var(--neon-pink);
            border-color: var(--neon-pink);
            box-shadow: var(--glow-effect);
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 25px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            background-color: transparent;
            color: var(--white);
            position: relative;
            overflow: hidden;
            border: 1px solid var(--neon-pink);
        }
        
        .btn:hover {
            background-color: rgba(157, 0, 255, 0.2);
            box-shadow: var(--glow-effect);
            transform: translateY(-3px);
        }
        
        .btn-primary {
            border-color: var(--neon-pink);
            color: var(--neon-pink);
        }
        
        .btn-secondary {
            border-color: var(--neon-purple);
            color: var(--neon-purple);
        }
        
        /* Footer */
        footer {
            background-color: rgba(0, 0, 0, 0.9);
            padding: 30px 5%;
            text-align: center;
            margin-top: 50px;
            border-top: 1px solid var(--neon-purple);
        }
        
        .footer-logo {
            height: 30px;
            margin-bottom: 20px;
            filter: drop-shadow(var(--glow-effect));
        }
        
        .social-links {
            margin: 20px 0;
        }
        
        .social-links a {
            color: var(--white);
            margin: 0 10px;
            font-size: 1.2rem;
            transition: all 0.3s;
        }
        
        .social-links a:hover {
            color: var(--neon-pink);
            text-shadow: 0 0 10px var(--neon-pink);
        }
        
        .copyright {
            color: var(--neon-purple);
            font-size: 0.9rem;
            text-shadow: 0 0 5px var(--neon-pink);
        }
        
        /* Order Confirmation Styles */
        .order-confirmation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease-out;
        }
        
        .confirmation-content {
            background: rgba(10,10,10,0.95);
            border: 1px solid var(--neon-pink);
            border-radius: 10px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: var(--glow-effect);
            position: relative;
        }
        
        .confirmation-title {
            color: var(--neon-pink);
            margin-bottom: 20px;
            font-size: 1.8rem;
            text-shadow: 0 0 10px var(--neon-pink);
        }
        
        .confirmation-message {
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .order-details {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid var(--neon-purple);
        }
        
        .order-id {
            font-weight: bold;
            color: var(--neon-pink);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Cart Styles */
        .cart-icon {
            position: relative;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s;
        }
        
        .cart-icon:hover {
            color: var(--neon-pink);
            text-shadow: 0 0 10px var(--neon-pink);
        }
        
        .cart-counter {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: var(--neon-pink);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .cart-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            width: 350px;
            max-height: 500px;
            overflow-y: auto;
            background-color: rgba(0, 0, 0, 0.95);
            border: 1px solid var(--neon-purple);
            border-radius: 8px;
            padding: 15px;
            z-index: 1000;
            box-shadow: var(--glow-effect);
        }
        
        .cart-item {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }
        
        .cart-item img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 5px;
            margin-right: 15px;
            border: 1px solid var(--neon-purple);
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .cart-item-details {
            font-size: 0.9rem;
            color: #ccc;
            margin-bottom: 5px;
        }
        
        .remove-item {
            background: none;
            border: none;
            color: #ff5555;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 0;
        }
        
        .remove-item:hover {
            text-decoration: underline;
        }
        
        .cart-total {
            font-weight: bold;
            text-align: right;
            margin-top: 15px;
            font-size: 1.2rem;
        }
        
        .checkout-btn {
            width: 100%;
            margin-top: 15px;
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            background-color: var(--neon-purple);
            color: white;
            border-radius: 5px;
            z-index: 1000;
            box-shadow: var(--glow-effect);
            animation: slideIn 0.3s ease-out;
        }
        
        .toast-error {
            background-color: #ff5555;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* Checkout Modal */
        .checkout-summary {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .checkout-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .tab {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }
            
            model-viewer {
                height: 300px;
            }
            
            nav {
                display: none;
            }
            
            .confirmation-content {
                padding: 20px;
            }
            
            .confirmation-title {
                font-size: 1.5rem;
            }
            
            .cart-dropdown {
                width: 300px;
                right: -50px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <img src="logo-imatge.PNG" alt="FREE4ALLRIDERS" class="logo">
        <nav>
            <a href="index.html">Home</a>
            <a href="index.html#products">Collection</a>
            <a href="Contact.html">Contact</a>
            <a href="#" id="authLink">Login</a>
            <div class="cart-icon" id="cartIcon">
                ðŸ›’ <span class="cart-counter" id="cartCounter" style="display: none;">0</span>
                <div class="cart-dropdown" id="cartDropdown">
                    <div id="cartItemsContainer">
                        <p>Your cart is empty</p>
                    </div>
                    <div class="cart-total">
                        Total: $<span id="cartTotal">0.00</span>
                    </div>
                    <button class="btn btn-primary checkout-btn" id="checkoutBtn">Checkout</button>
                </div>
            </div>
        </nav>
    </header>
    
    <!-- Main Content -->
    <div class="main-container">
        <!-- Product Tabs -->
        <div class="tab-container" id="tabContainer">
            <div class="tabs" id="tabs">
                <!-- Classic View -->
                <div class="tab">
                    <div class="image-section">
                        <img src="Jaket.PNG" alt="JACKET" class="product-image" id="productImage">
                        <div class="image-buttons">
                            <button class="img-btn" id="switchBtn">SWITCH</button>
                            <button class="img-btn" id="morePhotosBtn">MORE PHOTOS</button>
                        </div>
                    </div>
                    
                    <div class="details-section">
                        <h1 class="product-title">EXCLUSIVE BAKLAVA JACKET</h1>
                        <div class="product-price">40$</div>
                        
                        <p class="product-description">
                            Made from water-resistant fabric, this jacket keeps you warm and comfortable in any condition.
                            It features the F4AR logo on the front and bold lettering on the back, combining freestyle attitude with everyday wear.
                            Plus, it includes a built-in balaclava for extra protection against the cold.
                        </p>
                        
                        <div class="size-selector">
                            <h3>AVAILABLE SIZES:</h3>
                            <div class="size-options">
                                <span class="size-option">S</span>
                                <span class="size-option selected">M</span>
                                <span class="size-option">L</span>
                                <span class="size-option">XL</span>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="addToCartBtn">ADD TO CART</button>
                            <button class="btn btn-secondary" id="buyNowBtn">BUY NOW</button>
                        </div>
                    </div>
                </div>
                
                <!-- 3D View -->
                <div class="tab">
                    <div class="image-section">
                        <model-viewer src="hoodie.glb" alt="3D View of the hoodie" auto-rotate camera-controls></model-viewer>
                    </div>
                    
                    <div class="details-section">
                        <h1 class="product-title">3D MODE ACTIVATED</h1>
                        <div class="product-price">20$</div>
                        
                        <p class="product-description">
                            Explore every detail of our hoodie in 360Â°.
                            <br><br>
                            <strong>CONTROLS:</strong>
                            <br>Drag to rotate
                            <br>Double click to reset
                        </p>
                        
                        <div class="size-selector">
                            <h3>AVAILABLE SIZES:</h3>
                            <div class="size-options">
                                <span class="size-option">S</span>
                                <span class="size-option selected">M</span>
                                <span class="size-option">L</span>
                                <span class="size-option">XL</span>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="addToCartBtn3D">ADD TO CART</button>
                            <button class="btn btn-secondary" id="buyNowBtn3D">BUY NOW</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Photo Gallery Modal -->
    <div id="photosModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeModal">&times;</span>
            <h2 style="color: var(--neon-pink); text-align: center; margin-bottom: 20px;">PRODUCT GALLERY</h2>
            
            <div class="gallery-grid">
                <img src="Familly.jpeg" alt="Front view with the hoodie" class="gallery-img">
                <img src="Back.jpeg" alt="Back view of the hoodie" class="gallery-img">
            </div>
        </div>
    </div>
    
    <!-- Login Modal -->
    <div id="loginModal" class="login-modal">
        <div class="login-content">
            <span class="close-login" id="closeLogin">&times;</span>
            <h2 class="login-title">LOGIN</h2>
            <div id="loginErrorMessage" class="error-message"></div>
            <form class="login-form" id="loginForm">
                <input type="email" id="loginEmail" placeholder="Email" required>
                <input type="password" id="loginPassword" placeholder="Password" required>
                <button type="submit" class="login-btn">LOGIN</button>
            </form>
            <div style="text-align: center; margin-top: 20px; color: #ccc;">
                <p>Don't have an account? <a href="register.html" style="color: var(--neon-purple);">Register</a></p>
            </div>
        </div>
    </div>
    
    <!-- Order Confirmation Modal -->
    <div id="orderConfirmation" class="order-confirmation">
        <div class="confirmation-content">
            <h2 class="confirmation-title">Order Received!</h2>
            <p class="confirmation-message">Thank you for your purchase. We have received your order successfully.</p>
            
            <div class="order-details">
                <p>Product: <strong>HOODIE FOR RIDER ONLY</strong></p>
                <p>Size: <strong id="confirmedSize"></strong></p>
                <p>Price: <strong id="confirmedPrice">20$</strong></p>
                <p>Order ID: <span class="order-id" id="orderId"></span></p>
            </div>
            
            <button class="btn btn-primary" onclick="document.getElementById('orderConfirmation').style.display = 'none'">Close</button>
        </div>
    </div>
    
    <!-- Checkout Modal -->
    <div id="checkoutModal" class="order-confirmation">
        <div class="confirmation-content">
            <h2 class="confirmation-title">Order Summary</h2>
            <div class="checkout-summary" id="checkoutSummary">
                <!-- Cart items will be added here -->
            </div>
            <div class="cart-total" style="text-align: right; font-size: 1.2rem;">
                Total: $<span id="checkoutTotal">0.00</span>
            </div>
            <div class="action-buttons" style="margin-top: 20px;">
                <button class="btn btn-primary" id="confirmCheckout">Confirm Purchase</button>
                <button class="btn btn-secondary" onclick="document.getElementById('checkoutModal').style.display = 'none'">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <img src="logo-imatge.PNG" alt="FREE4ALLRIDERS" class="footer-logo">
        <div class="social-links">
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-facebook"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-tiktok"></i></a>
        </div>
        <p class="copyright">Â© 2025 FREE4ALLRIDERS | CYBER COLLECTION</p>
    </footer>

    <!-- Firebase Configuration -->
    <script>
        // Firebase Configuration (replace with your real data)
        const firebaseConfig = {
            apiKey: "AIzaSyAnhkZ3lkRpS8bBHI8OKYlYmpyRisahrdQ",
            authDomain: "free4allriders-51c5e.firebaseapp.com",
            projectId: "free4allriders-51c5e",
            storageBucket: "free4allriders-51c5e.firebasestorage.app",
            messagingSenderId: "1082764494980",
            appId: "1:1082764494980:web:a124d3dfeed2c08d8b5ad1",
            measurementId: "G-7KEGQPK3P0"
        };

        // Firebase Initialization
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Error initializing Firebase:", error);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();
        const CART_STORAGE_KEY = 'free4all_cart_v2';

        // Cart object
        const cart = {
            items: [],
            
            init: function() {
                this.load();
                this.updateUI();
            },
            
            load: function() {
                const savedCart = localStorage.getItem(CART_STORAGE_KEY);
                if (savedCart) {
                    this.items = JSON.parse(savedCart);
                }
            },
            
            save: function() {
                localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(this.items));
                this.updateUI();
            },
            
            addItem: function(product) {
                const existingItem = this.items.find(item => 
                    item.id === product.id && item.size === product.size);
                
                if (existingItem) {
                    existingItem.quantity += product.quantity;
                } else {
                    this.items.push(product);
                }
                
                this.save();
                showToast('Product added to cart');
            },
            
            removeItem: function(index) {
                this.items.splice(index, 1);
                this.save();
                showToast('Product removed from cart');
            },
            
            clear: function() {
                this.items = [];
                localStorage.removeItem(CART_STORAGE_KEY);
                this.updateUI();
            },
            
            getTotal: function() {
                return this.items.reduce((total, item) => {
                    return total + (item.price * item.quantity);
                }, 0);
            },
            
            getTotalItems: function() {
                return this.items.reduce((total, item) => {
                    return total + item.quantity;
                }, 0);
            },
            
            updateUI: function() {
                const totalItems = this.getTotalItems();
                const counter = document.getElementById('cartCounter');
                
                if (totalItems > 0) {
                    counter.textContent = totalItems;
                    counter.style.display = 'flex';
                } else {
                    counter.style.display = 'none';
                }
                
                const cartItemsContainer = document.getElementById('cartItemsContainer');
                const cartTotalElement = document.getElementById('cartTotal');
                
                cartItemsContainer.innerHTML = '';
                
                if (this.items.length === 0) {
                    cartItemsContainer.innerHTML = '<p>Your cart is empty</p>';
                    cartTotalElement.textContent = '0.00';
                    return;
                }
                
                this.items.forEach((item, index) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'cart-item';
                    itemElement.innerHTML = `
                        <img src="${item.image}" alt="${item.name}">
                        <div class="cart-item-info">
                            <div class="cart-item-title">${item.name}</div>
                            <div class="cart-item-details">Size: ${item.size} | Quantity: ${item.quantity}</div>
                            <div class="cart-item-details">$${(item.price * item.quantity).toFixed(2)}</div>
                            <button class="remove-item" data-index="${index}">Remove</button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(itemElement);
                });
                
                cartTotalElement.textContent = this.getTotal().toFixed(2);
                
                document.querySelectorAll('.remove-item').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = parseInt(e.target.getAttribute('data-index'));
                        this.removeItem(index);
                    });
                });
            }
        };

        // Function to show notifications
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast${type === 'error' ? ' toast-error' : ''}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Function to process the order
        async function processOrder() {
            const user = auth.currentUser;
            
            if (!user) {
                showToast('Please log in to continue', 'error');
                document.getElementById('loginModal').style.display = 'block';
                return null;
            }
            
            try {
                const batch = db.batch();
                const ordersCollection = db.collection('orders');
                const orderIds = [];
                
                cart.items.forEach(item => {
                    const orderRef = ordersCollection.doc();
                    orderIds.push(orderRef.id);
                    
                    batch.set(orderRef, {
                        userId: user.uid,
                        userEmail: user.email,
                        productId: item.id,
                        productName: item.name,
                        size: item.size,
                        quantity: item.quantity,
                        price: item.price,
                        total: item.price * item.quantity,
                        status: 'completed',
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        ip: '',
                        shippingAddress: '',
                        paymentMethod: 'Card'
                    });
                });
                
                try {
                    const ipResponse = await fetch('https://api.ipify.org?format=json');
                    const ipData = await ipResponse.json();
                    
                    cart.items.forEach((item, index) => {
                        const orderRef = ordersCollection.doc(orderIds[index]);
                        batch.update(orderRef, {
                            ip: ipData.ip
                        });
                    });
                } catch (ipError) {
                    console.error("Error getting IP:", ipError);
                }
                
                await batch.commit();
                return orderIds;
                
            } catch (error) {
                console.error("Error processing order:", error);
                throw error;
            }
        }

        // Function to update checkout summary
        function updateCheckoutSummary() {
            const summaryElement = document.getElementById('checkoutSummary');
            const totalElement = document.getElementById('checkoutTotal');
            
            summaryElement.innerHTML = '';
            
            if (cart.items.length === 0) {
                summaryElement.innerHTML = '<p>No products in cart</p>';
                totalElement.textContent = '0.00';
                return;
            }
            
            cart.items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'checkout-item';
                itemElement.innerHTML = `
                    <div>
                        <strong>${item.name}</strong> (${item.size})
                        <br><small>Quantity: ${item.quantity}</small>
                    </div>
                    <div>$${(item.price * item.quantity).toFixed(2)}</div>
                `;
                summaryElement.appendChild(itemElement);
            });
            
            totalElement.textContent = cart.getTotal().toFixed(2);
        }

        // Initialization when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize cart
            cart.init();
            
            // Configure cart icon
            const cartIcon = document.getElementById('cartIcon');
            const cartDropdown = document.getElementById('cartDropdown');
            
            cartIcon.addEventListener('click', (e) => {
                e.stopPropagation();
                cartDropdown.style.display = cartDropdown.style.display === 'block' ? 'none' : 'block';
            });
            
            document.addEventListener('click', () => {
                cartDropdown.style.display = 'none';
            });
            
            // Add to cart button (normal view)
            document.getElementById('addToCartBtn').addEventListener('click', () => {
                const product = {
                    id: 'hoodie-rider-1',
                    name: document.querySelector('.product-title').textContent,
                    price: parseFloat(document.querySelector('.product-price').textContent.replace('$', '')),
                    size: document.querySelector('.size-option.selected').textContent,
                    quantity: 1,
                    image: document.querySelector('.product-image').src
                };
                
                cart.addItem(product);
            });
            
            // Add to cart button (3D view)
            document.getElementById('addToCartBtn3D').addEventListener('click', () => {
                const product = {
                    id: 'hoodie-rider-1',
                    name: 'HOODIE FOR RIDER ONLY (3D)',
                    price: parseFloat(document.querySelector('.product-price').textContent.replace('$', '')),
                    size: document.querySelector('.size-option.selected').textContent,
                    quantity: 1,
                    image: 'hoodie.glb'
                };
                
                cart.addItem(product);
            });
            
            // Buy now button (normal view)
            document.getElementById('buyNowBtn').addEventListener('click', () => {
                const product = {
                    id: 'hoodie-rider-1',
                    name: document.querySelector('.product-title').textContent,
                    price: parseFloat(document.querySelector('.product-price').textContent.replace('$', '')),
                    size: document.querySelector('.size-option.selected').textContent,
                    quantity: 1,
                    image: document.querySelector('.product-image').src
                };
                
                cart.clear();
                cart.addItem(product);
                document.getElementById('checkoutModal').style.display = 'flex';
                updateCheckoutSummary();
            });
            
            // Buy now button (3D view)
            document.getElementById('buyNowBtn3D').addEventListener('click', () => {
                const product = {
                    id: 'hoodie-rider-1',
                    name: 'HOODIE FOR RIDER ONLY (3D)',
                    price: parseFloat(document.querySelector('.product-price').textContent.replace('$', '')),
                    size: document.querySelector('.size-option.selected').textContent,
                    quantity: 1,
                    image: 'hoodie.glb'
                };
                
                cart.clear();
                cart.addItem(product);
                document.getElementById('checkoutModal').style.display = 'flex';
                updateCheckoutSummary();
            });
            
            // Checkout button (from cart dropdown)
            document.getElementById('checkoutBtn').addEventListener('click', () => {
                if (cart.getTotalItems() === 0) {
                    showToast('Cart is empty', 'error');
                    return;
                }
                
                document.getElementById('checkoutModal').style.display = 'flex';
                updateCheckoutSummary();
            });
            
            // Confirm purchase button (in checkout modal)
            document.getElementById('confirmCheckout').addEventListener('click', async () => {
                try {
                    const orderIds = await processOrder();
                    
                    if (orderIds) {
                        document.getElementById('checkoutModal').style.display = 'none';
                        document.getElementById('confirmedSize').textContent = 
                            cart.items.map(item => `${item.size} (x${item.quantity})`).join(', ');
                        document.getElementById('confirmedPrice').textContent = `$${cart.getTotal().toFixed(2)}`;
                        document.getElementById('orderId').textContent = orderIds.join(', ');
                        document.getElementById('orderConfirmation').style.display = 'flex';
                        cart.clear();
                    }
                } catch (error) {
                    showToast('Error processing purchase: ' + error.message, 'error');
                    console.error("Checkout error:", error);
                }
            });
            
            // Size selector
            document.querySelectorAll('.size-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.size-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                });
            });
            
            // Improved authentication system
            const authLink = document.getElementById('authLink');
            const loginModal = document.getElementById('loginModal');
            const closeLogin = document.getElementById('closeLogin');
            const loginForm = document.getElementById('loginForm');
            const loginErrorMessage = document.getElementById('loginErrorMessage');
            
            function showLoginModal() {
                loginModal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
            
            authLink.addEventListener('click', (e) => {
                if (auth.currentUser) {
                    e.preventDefault();
                    auth.signOut().then(() => {
                        showToast('Logged out successfully');
                    }).catch(error => {
                        showToast('Error logging out', 'error');
                    });
                } else {
                    e.preventDefault();
                    showLoginModal();
                }
            });
            
            closeLogin.addEventListener('click', () => {
                loginModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
            
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                auth.signInWithEmailAndPassword(email, password)
                    .then(() => {
                        loginModal.style.display = 'none';
                        document.body.style.overflow = 'auto';
                        loginErrorMessage.textContent = '';
                        showToast('Logged in successfully');
                    })
                    .catch(error => {
                        loginErrorMessage.textContent = getAuthErrorMessage(error.code);
                    });
            });
            
            function getAuthErrorMessage(errorCode) {
                switch(errorCode) {
                    case 'auth/invalid-email': return 'Invalid email';
                    case 'auth/user-disabled': return 'Account disabled';
                    case 'auth/user-not-found': return 'User not found';
                    case 'auth/wrong-password': return 'Wrong password';
                    default: return 'Login error';
                }
            }
            
            // Improved auth state observer
            auth.onAuthStateChanged(user => {
                const authLink = document.getElementById('authLink');
                if (user) {
                    authLink.textContent = 'Logout';
                    authLink.href = '#';
                } else {
                    authLink.textContent = 'Login';
                    authLink.href = 'login.html';
                }
            });
            
            // Photo gallery
            const morePhotosBtn = document.getElementById('morePhotosBtn');
            const photosModal = document.getElementById('photosModal');
            const closeModal = document.getElementById('closeModal');
            
            morePhotosBtn.addEventListener('click', () => {
                photosModal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            });
            
            closeModal.addEventListener('click', () => {
                photosModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
            
            // View switching
            const switchBtn = document.getElementById('switchBtn');
            const productImage = document.getElementById('productImage');
            let isMainImage = true;
            const mainImage = 'Hoodie-black.jpeg';
            const altImage = 'Hoodie-white.jpeg';
            
            switchBtn.addEventListener('click', () => {
                productImage.src = isMainImage ? altImage : mainImage;
                isMainImage = !isMainImage;
            });
        });
    </script>
</body>
</html>
